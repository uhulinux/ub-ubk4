#!/bin/sh -eux

export CFLAGS+="-D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -fPIC"

mkdir build
cd build
cmake \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX="/usr" \
	-DMYSQL_MAINTAINER_MODE=OFF \
	-DMYSQL_USE_BUNDLED_READLINE=OFF \
	-DINSTALL_LAYOUT=DEB \
	-DWITH_LIBWRAP=1 \
	-DWITH_READLINE=1 \
	-DWITH_ZLIB=system \
	-DWITH_SSL=system \
	-DWITH_PCRE=system \
	-DWITH_EMBEDDED_SERVER=1 \
	-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
	-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
	-DWITH_INNOBASE_STORAGE_ENGINE=1 \
	-DENABLED_LOCAL_INFILE=1 \
	-DDEFAULT_CHARSET=utf8 \
	-DDEFAULT_COLLATION=utf8_general_ci \
	-DEXTRA_CHARSETS=all \
	-DWITH_TOKUDB=ON \
	-DWITH_MROONGA=ON \
	-DINSTALL_UNIX_ADDRDIR=/run/mysqld/mysqld.sock \
	..
ub_make
