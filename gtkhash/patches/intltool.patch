From 1f7e774f514e4822384db6f8a47914b408189c9e Mon Sep 17 00:00:00 2001
From: Tristan Heaven <tristan@tristanheaven.net>
Date: Sun, 19 Jul 2020 23:36:10 +0100
Subject: [PATCH] Remove dependency on intltool

---
 .gitignore                                    |  12 +-
 .gitlab-ci.yml                                |   2 -
 .travis.yml                                   |   1 -
 autogen.sh                                    |  12 +-
 configure.ac                                  |  22 +--
 data/Makefile.am                              |   7 +-
 data/appdata/Makefile.am                      |   3 +-
 .../org.gtkhash.caja.metainfo.xml.in.in       |   5 +-
 .../org.gtkhash.gtkhash.appdata.xml.in.in     |  11 +-
 .../org.gtkhash.nautilus.metainfo.xml.in.in   |   5 +-
 .../org.gtkhash.nemo.metainfo.xml.in.in       |   5 +-
 .../org.gtkhash.peony.metainfo.xml.in.in      |   4 +-
 .../org.gtkhash.thunar.metainfo.xml.in.in     |   5 +-
 data/caja/Makefile.am                         |   4 +-
 ...khash-properties-caja.caja-extension.in.in |   4 +-
 data/gtkhash-gtk3.gresource.xml               |   2 +-
 data/{gtkhash-gtk3.xml => gtkhash-gtk3.ui}    |   0
 data/nautilus/Makefile.am                     |   3 +-
 .../nautilus/gtkhash-properties.gresource.xml |   2 +-
 ...h-properties.xml => gtkhash-properties.ui} |   0
 data/org.gtkhash.gtkhash.desktop.in           |   4 +-
 data/peony/Makefile.am                        |   4 +-
 ...ash-properties-peony.peony-extension.in.in |   4 +-
 msys2/installdeps.sh                          |   3 +-
 msys2/mingw-w64-gtkhash/PKGBUILD              |   1 -
 po/LINGUAS                                    |   4 +-
 po/Makevars                                   |  78 ++++++++
 po/POTFILES.in                                |   8 +-
 po/POTFILES.skip                              |  13 --
 po/gtkhash.pot                                | 177 +++++++++---------
 po/nb_NO.po                                   |   2 +-
 po/zh_CN.po                                   |   2 -
 snap/snapcraft.yaml                           |   1 -
 src/Makefile.am                               |   2 +-
 src/gui.c                                     |   2 +-
 src/main.h                                    |   5 +-
 src/nautilus/Makefile.am                      |   2 +-
 src/nautilus/properties.c                     |   2 +-
 src/nautilus/properties.h                     |   4 +-
 39 files changed, 237 insertions(+), 190 deletions(-)
 rename data/{gtkhash-gtk3.xml => gtkhash-gtk3.ui} (100%)
 rename data/nautilus/{gtkhash-properties.xml => gtkhash-properties.ui} (100%)
 create mode 100644 po/Makevars
 delete mode 100644 po/POTFILES.skip

diff --git a/.gitignore b/.gitignore
index ed11bd0..3823428 100644
--- a/.gitignore
+++ b/.gitignore
@@ -18,19 +18,27 @@ data/icons/64/
 data/icons/128/
 data/icons/256/
 
+po/*.header
+po/*.sed
+po/*.sin
+po/*.template
+po/POTFILES
+po/Rules-quot
+po/stamp-po
+
 .deps/
 .libs/
 autom4te.cache/
 build-aux/
+intl/
 m4/
 
 .dirstamp
-.intltool-merge-cache
+ABOUT-NLS
 INSTALL
 Makefile
 Makefile.in
 Makefile.in.in
-POTFILES
 aclocal.m4
 config.h
 config.h.in
diff --git a/.gitlab-ci.yml b/.gitlab-ci.yml
index effdf08..b530257 100644
--- a/.gitlab-ci.yml
+++ b/.gitlab-ci.yml
@@ -24,7 +24,6 @@ fedora:
     - dnf -y install
         make
         libtool
-        intltool
         glib-devel
         gtk3-devel
         libgcrypt-devel
@@ -59,7 +58,6 @@ ubuntu:
     - apt-get -y install
         build-essential
         libtool
-        intltool
         libglib2.0-dev
         libgtk-3-dev
         libgcrypt20-dev
diff --git a/.travis.yml b/.travis.yml
index aa491e7..7b2eed7 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -10,7 +10,6 @@ addons:
   apt:
     packages:
       - libtool
-      - intltool
       - libglib2.0-dev
       - libgtk-3-dev
       - libgcrypt20-dev
diff --git a/autogen.sh b/autogen.sh
index 414ebb8..e237999 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -1,13 +1,3 @@
 #!/bin/sh
 
-set -e
-set -x
-
-[ -f autogen.sh ]
-
-[ ! -d m4 ] && mkdir m4
-[ ! -d build-aux ] && mkdir build-aux
-
-glib-gettextize --copy --force
-intltoolize --automake --copy --force
-autoreconf --force --install
+exec autoreconf -v -Wall --force --install
diff --git a/configure.ac b/configure.ac
index f4f84f7..752695f 100644
--- a/configure.ac
+++ b/configure.ac
@@ -13,6 +13,13 @@ AM_PROG_CC_C_O
 AM_PROG_AR
 LT_INIT
 
+GETTEXT_PACKAGE="${PACKAGE}"
+AC_SUBST([GETTEXT_PACKAGE])
+AC_DEFINE_UNQUOTED([GETTEXT_PACKAGE], ["${GETTEXT_PACKAGE}"], [Define the gettext package])
+AM_GNU_GETTEXT([external])
+AM_GNU_GETTEXT_VERSION([0.19.7])
+AM_CONDITIONAL([ENABLE_NLS], [test "${enable_nls}" != "no"])
+
 GTKHASH_CFLAGS=""
 
 for opt in \
@@ -409,21 +416,6 @@ AM_CONDITIONAL([ENABLE_NAUTILUS_DATA], [
 	test "${enable_peony}" = "yes" ||
 	test "${enable_thunar}" = "yes"])
 
-# nls option {{{
-AM_CONDITIONAL([ENABLE_NLS], [test "${enable_nls}" != "no"])
-
-if test "${enable_nls}" != "no" ; then
-	AC_DEFINE([ENABLE_NLS], [1], [Native Language Support])
-	GETTEXT_PACKAGE="${PACKAGE}"
-	AC_SUBST([GETTEXT_PACKAGE])
-	AC_DEFINE_UNQUOTED([GETTEXT_PACKAGE], ["${GETTEXT_PACKAGE}"], [Define the gettext package])
-	IT_PROG_INTLTOOL([0.40.6])
-	AM_GLIB_GNU_GETTEXT
-else
-	AC_DEFINE([ENABLE_NLS], [0], [Native Language Support])
-fi
-# }}}
-
 # Matches preferred order from src/hash/hash-lib.c
 HASH_LIBS="blake2 gcrypt libcrypto mbedtls nettle linux_crypto zlib glib_checksums internal_md6"
 AC_SUBST([HASH_LIBS])
diff --git a/data/Makefile.am b/data/Makefile.am
index 64766c5..b95099f 100644
--- a/data/Makefile.am
+++ b/data/Makefile.am
@@ -26,12 +26,13 @@ gsettings_SCHEMAS = org.gtkhash.gschema.xml
 EXTRA_DIST = \
 	$(applications_DATA).in \
 	$(gsettings_SCHEMAS) \
-	gtkhash-gtk3.xml gtkhash-gtk3.gresource.xml
+	gtkhash-gtk3.ui gtkhash-gtk3.gresource.xml
 
 CLEANFILES = $(applications_DATA)
 
 endif
 
-@INTLTOOL_DESKTOP_RULE@
-@INTLTOOL_XML_NOMERGE_RULE@
+%.desktop: %.desktop.in
+	$(AM_V_GEN)$(MSGFMT) --desktop --template $< -d $(top_srcdir)/po -o $@
+
 @GSETTINGS_RULES@
diff --git a/data/appdata/Makefile.am b/data/appdata/Makefile.am
index b3d8ede..cb40a72 100644
--- a/data/appdata/Makefile.am
+++ b/data/appdata/Makefile.am
@@ -35,4 +35,5 @@ EXTRA_DIST = \
 	org.gtkhash.peony.metainfo.xml.in \
 	org.gtkhash.thunar.metainfo.xml.in
 
-@INTLTOOL_XML_RULE@
+%.xml: %.xml.in
+	$(AM_V_GEN)$(MSGFMT) --xml --template $< -d $(top_srcdir)/po -o $@
diff --git a/data/appdata/org.gtkhash.caja.metainfo.xml.in.in b/data/appdata/org.gtkhash.caja.metainfo.xml.in.in
index 9403262..285cd21 100644
--- a/data/appdata/org.gtkhash.caja.metainfo.xml.in.in
+++ b/data/appdata/org.gtkhash.caja.metainfo.xml.in.in
@@ -4,10 +4,11 @@
   <extends>caja.desktop</extends>
   <metadata_license>CC0-1.0</metadata_license>
   <project_license>GPL-2.0+</project_license>
-  <_name>Checksums</_name>
-  <_summary>Adds message digests or checksums to file properties</_summary>
+  <name>Checksums</name>
+  <summary>Adds message digests or checksums to file properties</summary>
   <url type="homepage">https://github.com/tristanheaven/gtkhash</url>
   <url type="bugtracker">https://github.com/tristanheaven/gtkhash/issues</url>
+  <url type="translate">https://hosted.weblate.org/engage/gtkhash/</url>
   <developer_name>Tristan Heaven</developer_name>
   <update_contact>tristan@tristanheaven.net</update_contact>
   <content_rating type="oars-1.1"/>
diff --git a/data/appdata/org.gtkhash.gtkhash.appdata.xml.in.in b/data/appdata/org.gtkhash.gtkhash.appdata.xml.in.in
index 549173e..ed0d0fd 100644
--- a/data/appdata/org.gtkhash.gtkhash.appdata.xml.in.in
+++ b/data/appdata/org.gtkhash.gtkhash.appdata.xml.in.in
@@ -5,16 +5,16 @@
   <metadata_license>CC0-1.0</metadata_license>
   <project_license>GPL-2.0+</project_license>
   <name>GtkHash</name>
-  <_summary>Calculate message digests or checksums</_summary>
+  <summary>Calculate message digests or checksums</summary>
   <description>
-    <_p>
+    <p>
       GtkHash is an application for computing file checksums, or message
       digests. It's designed to be an easy to use, graphical alternative to
       command-line programs such as md5sum.
-    </_p>
-    <_p>
+    </p>
+    <p>
       Supported hash functions include MD5, SHA1, SHA256, SHA512 and CRC32.
-    </_p>
+    </p>
   </description>
   <screenshots>
     <screenshot type="default">
@@ -31,6 +31,7 @@
   </provides>
   <url type="homepage">https://github.com/tristanheaven/gtkhash</url>
   <url type="bugtracker">https://github.com/tristanheaven/gtkhash/issues</url>
+  <url type="translate">https://hosted.weblate.org/engage/gtkhash/</url>
   <developer_name>Tristan Heaven</developer_name>
   <update_contact>tristan@tristanheaven.net</update_contact>
   <translation type="gettext">gtkhash</translation>
diff --git a/data/appdata/org.gtkhash.nautilus.metainfo.xml.in.in b/data/appdata/org.gtkhash.nautilus.metainfo.xml.in.in
index bb0022a..b580ed7 100644
--- a/data/appdata/org.gtkhash.nautilus.metainfo.xml.in.in
+++ b/data/appdata/org.gtkhash.nautilus.metainfo.xml.in.in
@@ -4,10 +4,11 @@
   <extends>org.gnome.Nautilus.desktop</extends>
   <metadata_license>CC0-1.0</metadata_license>
   <project_license>GPL-2.0+</project_license>
-  <_name>Checksums</_name>
-  <_summary>Adds message digests or checksums to file properties</_summary>
+  <name>Checksums</name>
+  <summary>Adds message digests or checksums to file properties</summary>
   <url type="homepage">https://github.com/tristanheaven/gtkhash</url>
   <url type="bugtracker">https://github.com/tristanheaven/gtkhash/issues</url>
+  <url type="translate">https://hosted.weblate.org/engage/gtkhash/</url>
   <developer_name>Tristan Heaven</developer_name>
   <update_contact>tristan@tristanheaven.net</update_contact>
   <content_rating type="oars-1.1"/>
diff --git a/data/appdata/org.gtkhash.nemo.metainfo.xml.in.in b/data/appdata/org.gtkhash.nemo.metainfo.xml.in.in
index 4d273ad..555b803 100644
--- a/data/appdata/org.gtkhash.nemo.metainfo.xml.in.in
+++ b/data/appdata/org.gtkhash.nemo.metainfo.xml.in.in
@@ -5,10 +5,11 @@
   <extends>org.Nemo.desktop</extends>
   <metadata_license>CC0-1.0</metadata_license>
   <project_license>GPL-2.0+</project_license>
-  <_name>Checksums</_name>
-  <_summary>Adds message digests or checksums to file properties</_summary>
+  <name>Checksums</name>
+  <summary>Adds message digests or checksums to file properties</summary>
   <url type="homepage">https://github.com/tristanheaven/gtkhash</url>
   <url type="bugtracker">https://github.com/tristanheaven/gtkhash/issues</url>
+  <url type="translate">https://hosted.weblate.org/engage/gtkhash/</url>
   <developer_name>Tristan Heaven</developer_name>
   <update_contact>tristan@tristanheaven.net</update_contact>
   <content_rating type="oars-1.1"/>
diff --git a/data/appdata/org.gtkhash.peony.metainfo.xml.in.in b/data/appdata/org.gtkhash.peony.metainfo.xml.in.in
index 7b87903..bcf41e9 100644
--- a/data/appdata/org.gtkhash.peony.metainfo.xml.in.in
+++ b/data/appdata/org.gtkhash.peony.metainfo.xml.in.in
@@ -4,8 +4,8 @@
   <extends>peony.desktop</extends>
   <metadata_license>CC0-1.0</metadata_license>
   <project_license>GPL-2.0+</project_license>
-  <_name>Checksums</_name>
-  <_summary>Adds message digests or checksums to file properties</_summary>
+  <name>Checksums</name>
+  <summary>Adds message digests or checksums to file properties</summary>
   <url type="homepage">https://github.com/tristanheaven/gtkhash</url>
   <url type="bugtracker">https://github.com/tristanheaven/gtkhash/issues</url>
   <developer_name>Tristan Heaven</developer_name>
diff --git a/data/appdata/org.gtkhash.thunar.metainfo.xml.in.in b/data/appdata/org.gtkhash.thunar.metainfo.xml.in.in
index 57eb360..0c1da89 100644
--- a/data/appdata/org.gtkhash.thunar.metainfo.xml.in.in
+++ b/data/appdata/org.gtkhash.thunar.metainfo.xml.in.in
@@ -4,10 +4,11 @@
   <extends>Thunar.desktop</extends>
   <metadata_license>CC0-1.0</metadata_license>
   <project_license>GPL-2.0+</project_license>
-  <_name>Checksums</_name>
-  <_summary>Adds message digests or checksums to file properties</_summary>
+  <name>Checksums</name>
+  <summary>Adds message digests or checksums to file properties</summary>
   <url type="homepage">https://github.com/tristanheaven/gtkhash</url>
   <url type="bugtracker">https://github.com/tristanheaven/gtkhash/issues</url>
+  <url type="translate">https://hosted.weblate.org/engage/gtkhash/</url>
   <developer_name>Tristan Heaven</developer_name>
   <update_contact>tristan@tristanheaven.net</update_contact>
   <content_rating type="oars-1.1"/>
diff --git a/data/caja/Makefile.am b/data/caja/Makefile.am
index fefbe2e..2ec0d71 100644
--- a/data/caja/Makefile.am
+++ b/data/caja/Makefile.am
@@ -5,5 +5,5 @@ EXTRA_DIST = $(cajaextensions_DATA).in
 
 CLEANFILES = $(cajaextensions_DATA)
 
-%.caja-extension: %.caja-extension.in $(INTLTOOL_MERGE) $(wildcard $(top_srcdir)/po/*.po)
-	$(INTLTOOL_V_MERGE)LC_ALL=C $(INTLTOOL_MERGE) $(INTLTOOL_V_MERGE_OPTIONS) -d -u -c $(top_builddir)/po/.intltool-merge-cache $(top_srcdir)/po $< $@
+%.caja-extension: %.caja-extension.in
+	$(AM_V_GEN)$(MSGFMT) --desktop --keyword Name --keyword Description --template $< -d $(top_srcdir)/po -o $@
diff --git a/data/caja/libgtkhash-properties-caja.caja-extension.in.in b/data/caja/libgtkhash-properties-caja.caja-extension.in.in
index 92cbb4c..99db45f 100644
--- a/data/caja/libgtkhash-properties-caja.caja-extension.in.in
+++ b/data/caja/libgtkhash-properties-caja.caja-extension.in.in
@@ -1,7 +1,7 @@
 [Caja Extension]
 Icon=org.gtkhash.gtkhash
-_Name=Checksums
-_Description=Calculate message digests or checksums
+Name=Checksums
+Description=Calculate message digests or checksums
 Author=Tristan Heaven <tristan@tristanheaven.net>
 Copyright=
 Version=@VERSION@
diff --git a/data/gtkhash-gtk3.gresource.xml b/data/gtkhash-gtk3.gresource.xml
index 2e5d976..c22c1ef 100644
--- a/data/gtkhash-gtk3.gresource.xml
+++ b/data/gtkhash-gtk3.gresource.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <gresources>
 	<gresource prefix="/org/gtkhash">
-		<file compressed="true" preprocess="xml-stripblanks">gtkhash-gtk3.xml</file>
+		<file compressed="true" preprocess="xml-stripblanks">gtkhash-gtk3.ui</file>
 	</gresource>
 </gresources>
diff --git a/data/gtkhash-gtk3.xml b/data/gtkhash-gtk3.ui
similarity index 100%
rename from data/gtkhash-gtk3.xml
rename to data/gtkhash-gtk3.ui
diff --git a/data/nautilus/Makefile.am b/data/nautilus/Makefile.am
index 88cd166..58f3ed0 100644
--- a/data/nautilus/Makefile.am
+++ b/data/nautilus/Makefile.am
@@ -2,8 +2,7 @@ gsettings_SCHEMAS = org.gtkhash.plugin.gschema.xml
 
 EXTRA_DIST = \
 	$(gsettings_SCHEMAS) \
-	gtkhash-properties.xml \
+	gtkhash-properties.ui \
 	gtkhash-properties.gresource.xml
 
-@INTLTOOL_XML_NOMERGE_RULE@
 @GSETTINGS_RULES@
diff --git a/data/nautilus/gtkhash-properties.gresource.xml b/data/nautilus/gtkhash-properties.gresource.xml
index fa67aa8..0a3fbf4 100644
--- a/data/nautilus/gtkhash-properties.gresource.xml
+++ b/data/nautilus/gtkhash-properties.gresource.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <gresources>
 	<gresource prefix="/org/gtkhash/plugin">
-		<file compressed="true" preprocess="xml-stripblanks">gtkhash-properties.xml</file>
+		<file compressed="true" preprocess="xml-stripblanks">gtkhash-properties.ui</file>
 	</gresource>
 </gresources>
diff --git a/data/nautilus/gtkhash-properties.xml b/data/nautilus/gtkhash-properties.ui
similarity index 100%
rename from data/nautilus/gtkhash-properties.xml
rename to data/nautilus/gtkhash-properties.ui
diff --git a/data/org.gtkhash.gtkhash.desktop.in b/data/org.gtkhash.gtkhash.desktop.in
index bbc2941..5c11c8d 100644
--- a/data/org.gtkhash.gtkhash.desktop.in
+++ b/data/org.gtkhash.gtkhash.desktop.in
@@ -1,7 +1,7 @@
 [Desktop Entry]
 Name=GtkHash
-_GenericName=Checksum Calculator
-_Comment=Calculate message digests or checksums
+GenericName=Checksum Calculator
+Comment=Calculate message digests or checksums
 Keywords=hash;checksum;digest;md5;sha1;sha256;crc32;
 TryExec=gtkhash
 Exec=gtkhash %U
diff --git a/data/peony/Makefile.am b/data/peony/Makefile.am
index e5b45e4..2ebbf3e 100644
--- a/data/peony/Makefile.am
+++ b/data/peony/Makefile.am
@@ -5,5 +5,5 @@ EXTRA_DIST = $(peonyextensions_DATA).in
 
 CLEANFILES = $(peonyextensions_DATA)
 
-%.peony-extension: %.peony-extension.in $(INTLTOOL_MERGE) $(wildcard $(top_srcdir)/po/*.po)
-	$(INTLTOOL_V_MERGE)LC_ALL=C $(INTLTOOL_MERGE) $(INTLTOOL_V_MERGE_OPTIONS) -d -u -c $(top_builddir)/po/.intltool-merge-cache $(top_srcdir)/po $< $@
+%.peony-extension: %.peony-extension.in
+	$(AM_V_GEN)$(MSGFMT) --desktop --keyword Name --keyword Description --template $< -d $(top_srcdir)/po -o $@
diff --git a/data/peony/libgtkhash-properties-peony.peony-extension.in.in b/data/peony/libgtkhash-properties-peony.peony-extension.in.in
index 7e12f6d..a71cd73 100644
--- a/data/peony/libgtkhash-properties-peony.peony-extension.in.in
+++ b/data/peony/libgtkhash-properties-peony.peony-extension.in.in
@@ -1,7 +1,7 @@
 [Peony Extension]
 Icon=org.gtkhash.gtkhash
-_Name=Checksums
-_Description=Calculate message digests or checksums
+Name=Checksums
+Description=Calculate message digests or checksums
 Author=Tristan Heaven <tristan@tristanheaven.net>
 Copyright=
 Version=@VERSION@
diff --git a/msys2/installdeps.sh b/msys2/installdeps.sh
index 32a5eb0..3d454ca 100755
--- a/msys2/installdeps.sh
+++ b/msys2/installdeps.sh
@@ -13,5 +13,4 @@ pacman -S --noconfirm --needed --noprogressbar \
 	mingw-w64-{x86_64,i686}-gsettings-desktop-schemas \
 	mingw-w64-{x86_64,i686}-libgcrypt \
 	mingw-w64-{x86_64,i686}-styrene \
-	base-devel \
-	intltool
+	base-devel
diff --git a/msys2/mingw-w64-gtkhash/PKGBUILD b/msys2/mingw-w64-gtkhash/PKGBUILD
index b1f4a6b..419ac64 100644
--- a/msys2/mingw-w64-gtkhash/PKGBUILD
+++ b/msys2/mingw-w64-gtkhash/PKGBUILD
@@ -14,7 +14,6 @@ makedepends=(
 	${MINGW_PACKAGE_PREFIX}-libtool
 	${MINGW_PACKAGE_PREFIX}-pkg-config
 	git
-	intltool
 )
 options=( strip )
 license=( GPL )
diff --git a/po/LINGUAS b/po/LINGUAS
index b7295ab..0764e27 100644
--- a/po/LINGUAS
+++ b/po/LINGUAS
@@ -1,10 +1,12 @@
 ar
+bn_BD
 ca
 cs
 da
 de
 el
 en_GB
+en_US
 eo
 es
 fr
@@ -29,5 +31,3 @@ sv
 tr
 zh_CN
 zh_TW
-bn_BD
-en_US
diff --git a/po/Makevars b/po/Makevars
new file mode 100644
index 0000000..df10012
--- /dev/null
+++ b/po/Makevars
@@ -0,0 +1,78 @@
+# Makefile variables for PO directory in any package using GNU gettext.
+
+# Usually the message domain is the same as the package name.
+DOMAIN = $(PACKAGE)
+
+# These two variables depend on the location of this directory.
+subdir = po
+top_builddir = ..
+
+# These options get passed to xgettext.
+XGETTEXT_OPTIONS = --from-code=UTF-8 --keyword=_ --keyword=N_ --keyword=C_:1c,2 --keyword=NC_:1c,2 --keyword=g_dngettext:2,3 --add-comments
+
+# This is the copyright holder that gets inserted into the header of the
+# $(DOMAIN).pot file.  Set this to the copyright holder of the surrounding
+# package.  (Note that the msgstr strings, extracted from the package's
+# sources, belong to the copyright holder of the package.)  Translators are
+# expected to transfer the copyright for their translations to this person
+# or entity, or to disclaim their copyright.  The empty string stands for
+# the public domain; in this case the translators are expected to disclaim
+# their copyright.
+COPYRIGHT_HOLDER = GtkHash authors
+
+# This tells whether or not to prepend "GNU " prefix to the package
+# name that gets inserted into the header of the $(DOMAIN).pot file.
+# Possible values are "yes", "no", or empty.  If it is empty, try to
+# detect it automatically by scanning the files in $(top_srcdir) for
+# "GNU packagename" string.
+PACKAGE_GNU = no
+
+# This is the email address or URL to which the translators shall report
+# bugs in the untranslated strings:
+# - Strings which are not entire sentences, see the maintainer guidelines
+#   in the GNU gettext documentation, section 'Preparing Strings'.
+# - Strings which use unclear terms or require additional context to be
+#   understood.
+# - Strings which make invalid assumptions about notation of date, time or
+#   money.
+# - Pluralisation problems.
+# - Incorrect English spelling.
+# - Incorrect formatting.
+# It can be your email address, or a mailing list address where translators
+# can write to without being subscribed, or the URL of a web page through
+# which the translators can contact you.
+MSGID_BUGS_ADDRESS = https://github.com/tristanheaven/gtkhash/issues
+
+# This is the list of locale categories, beyond LC_MESSAGES, for which the
+# message catalogs shall be used.  It is usually empty.
+EXTRA_LOCALE_CATEGORIES =
+
+# This tells whether the $(DOMAIN).pot file contains messages with an 'msgctxt'
+# context.  Possible values are "yes" and "no".  Set this to yes if the
+# package uses functions taking also a message context, like pgettext(), or
+# if in $(XGETTEXT_OPTIONS) you define keywords with a context argument.
+USE_MSGCTXT = yes
+
+# These options get passed to msgmerge.
+# Useful options are in particular:
+#   --previous            to keep previous msgids of translated messages,
+#   --quiet               to reduce the verbosity.
+MSGMERGE_OPTIONS =
+
+# These options get passed to msginit.
+# If you want to disable line wrapping when writing PO files, add
+# --no-wrap to MSGMERGE_OPTIONS, XGETTEXT_OPTIONS, and
+# MSGINIT_OPTIONS.
+MSGINIT_OPTIONS =
+
+# This tells whether or not to regenerate a PO file when $(DOMAIN).pot
+# has changed.  Possible values are "yes" and "no".  Set this to no if
+# the POT file is checked in the repository and the version control
+# program ignores timestamps.
+PO_DEPENDS_ON_POT = no
+
+# This tells whether or not to forcibly update $(DOMAIN).pot and
+# regenerate PO files on "make dist".  Possible values are "yes" and
+# "no".  Set this to no if the POT file and PO files are maintained
+# externally.
+DIST_DEPENDS_ON_UPDATE_PO = no
diff --git a/po/POTFILES.in b/po/POTFILES.in
index b41ad39..14cf0dd 100644
--- a/po/POTFILES.in
+++ b/po/POTFILES.in
@@ -1,7 +1,5 @@
-[encoding: UTF-8]
-
 # gtkhash
-[type: gettext/glade]data/gtkhash-gtk3.xml
+data/gtkhash-gtk3.ui
 data/org.gtkhash.gtkhash.desktop.in
 src/callbacks.c
 src/check.c
@@ -14,9 +12,7 @@ src/prefs.c
 src/util/util.c
 
 # gtkhash-properties
-[type: gettext/ini]data/caja/libgtkhash-properties-caja.caja-extension.in
-[type: gettext/glade]data/nautilus/gtkhash-properties.xml
-[type: gettext/ini]data/peony/libgtkhash-properties-peony.peony-extension.in
+data/nautilus/gtkhash-properties.ui
 src/nautilus/properties.c
 src/nautilus/properties-hash.c
 src/nautilus/properties-list.c
diff --git a/po/POTFILES.skip b/po/POTFILES.skip
deleted file mode 100644
index c7491de..0000000
--- a/po/POTFILES.skip
+++ /dev/null
@@ -1,13 +0,0 @@
-# appdata
-data/appdata/org.gtkhash.gtkhash.appdata.xml.in.in
-data/appdata/org.gtkhash.caja.metainfo.xml.in.in
-data/appdata/org.gtkhash.nautilus.metainfo.xml.in.in
-data/appdata/org.gtkhash.nemo.metainfo.xml.in.in
-data/appdata/org.gtkhash.peony.metainfo.xml.in.in
-data/appdata/org.gtkhash.thunar.metainfo.xml.in.in
-sub/data/appdata/org.gtkhash.gtkhash.appdata.xml.in
-sub/data/appdata/org.gtkhash.caja.metainfo.xml.in
-sub/data/appdata/org.gtkhash.nautilus.metainfo.xml.in
-sub/data/appdata/org.gtkhash.nemo.metainfo.xml.in
-sub/data/appdata/org.gtkhash.peony.metainfo.xml.in
-sub/data/appdata/org.gtkhash.thunar.metainfo.xml.in
diff --git a/po/gtkhash.pot b/po/gtkhash.pot
index 003eddf..d79a504 100644
--- a/po/gtkhash.pot
+++ b/po/gtkhash.pot
@@ -1,14 +1,14 @@
 # SOME DESCRIPTIVE TITLE.
-# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
-# This file is distributed under the same license as the PACKAGE package.
+# Copyright (C) YEAR GtkHash authors
+# This file is distributed under the same license as the gtkhash package.
 # FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
 #
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2020-07-05 22:18+0100\n"
+"Project-Id-Version: gtkhash 1.4\n"
+"Report-Msgid-Bugs-To: https://github.com/tristanheaven/gtkhash/issues\n"
+"POT-Creation-Date: 2020-07-17 00:00+0100\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -18,299 +18,296 @@ msgstr ""
 "Content-Transfer-Encoding: 8bit\n"
 "Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n"
 
-#: ../data/gtkhash-gtk3.xml.h:1
+#: data/gtkhash-gtk3.ui:12
 msgid "Lowercase Hexadecimal"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:2
+#: data/gtkhash-gtk3.ui:15
 msgid "Uppercase Hexadecimal"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:3
+#: data/gtkhash-gtk3.ui:71
 msgid "Copy _Digest"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:4
+#: data/gtkhash-gtk3.ui:97
 msgid "Show _Toolbar"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:5
+#: data/gtkhash-gtk3.ui:141 data/gtkhash-gtk3.ui:290
 msgid "_File"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:6
+#: data/gtkhash-gtk3.ui:149
 msgctxt "menu"
 msgid "_Open Digest File…"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:7
+#: data/gtkhash-gtk3.ui:160
 msgctxt "menu"
 msgid "_Save Digest File…"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:8
+#: data/gtkhash-gtk3.ui:194
 msgid "_Edit"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:9
+#: data/gtkhash-gtk3.ui:280
 msgid "_View"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:10
+#: data/gtkhash-gtk3.ui:300
 msgid "_Text"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:11
+#: data/gtkhash-gtk3.ui:310
 msgid "File _List"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:12
+#: data/gtkhash-gtk3.ui:324
 msgid "_Help"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:13
+#: data/gtkhash-gtk3.ui:429
 msgid "File:"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:14
+#: data/gtkhash-gtk3.ui:442
 msgid "Text:"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:15 ../data/nautilus/gtkhash-properties.xml.h:5
+#: data/gtkhash-gtk3.ui:455 data/nautilus/gtkhash-properties.ui:144
 msgid "Check:"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:16 ../data/nautilus/gtkhash-properties.xml.h:6
+#: data/gtkhash-gtk3.ui:513 data/gtkhash-gtk3.ui:531
+#: data/nautilus/gtkhash-properties.ui:159
 msgid "Paste digest from clipboard"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:17 ../data/nautilus/gtkhash-properties.xml.h:7
+#: data/gtkhash-gtk3.ui:544 data/gtkhash-gtk3.ui:571
+#: data/nautilus/gtkhash-properties.ui:180
 msgid "HMAC Key:"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:18
+#: data/gtkhash-gtk3.ui:783
 msgid "File"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:19
+#: data/gtkhash-gtk3.ui:887
 msgid "Ha_sh"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:20
+#: data/gtkhash-gtk3.ui:953
 msgid "GtkHash Preferences"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:21
+#: data/gtkhash-gtk3.ui:1039
 msgid "Hash Functions"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:22
+#: data/gtkhash-gtk3.ui:1070
 msgid "MAC Functions"
 msgstr ""
 
-#: ../data/gtkhash-gtk3.xml.h:23
+#: data/gtkhash-gtk3.ui:1092
 msgid "Digest Format:"
 msgstr ""
 
-#: ../data/org.gtkhash.gtkhash.desktop.in.h:1
+#: data/org.gtkhash.gtkhash.desktop.in:4
 msgid "Checksum Calculator"
 msgstr ""
 
-#: ../data/org.gtkhash.gtkhash.desktop.in.h:2
-#: ../data/caja/libgtkhash-properties-caja.caja-extension.in.h:2
-#: ../data/peony/libgtkhash-properties-peony.peony-extension.in.h:2
-#: ../src/nautilus/properties.c:610
-#: ../data/appdata/org.gtkhash.gtkhash.appdata.xml.in.h:1
+#: data/org.gtkhash.gtkhash.desktop.in:5 src/nautilus/properties.c:610
+#: data/appdata/org.gtkhash.gtkhash.appdata.xml.in:8
 msgid "Calculate message digests or checksums"
 msgstr ""
 
-#: ../src/callbacks.c:51 ../src/callbacks.c:55
+#: src/callbacks.c:51 src/callbacks.c:55
 msgid "Open Digest File"
 msgstr ""
 
-#: ../src/callbacks.c:52 ../src/callbacks.c:58 ../src/callbacks.c:308
-#: ../src/callbacks.c:314
+#: src/callbacks.c:52 src/callbacks.c:58 src/callbacks.c:308
+#: src/callbacks.c:314
 msgid "_Open"
 msgstr ""
 
-#: ../src/callbacks.c:52 ../src/callbacks.c:57 ../src/callbacks.c:121
-#: ../src/callbacks.c:126 ../src/callbacks.c:308 ../src/callbacks.c:313
+#: src/callbacks.c:52 src/callbacks.c:57 src/callbacks.c:121
+#: src/callbacks.c:126 src/callbacks.c:308 src/callbacks.c:313
 msgid "_Cancel"
 msgstr ""
 
-#: ../src/callbacks.c:73
+#: src/callbacks.c:73
 msgid "Digest/Checksum Files (*.sha1, *.md5, *.sfv, …)"
 msgstr ""
 
-#: ../src/callbacks.c:78
+#: src/callbacks.c:78
 msgid "All Files"
 msgstr ""
 
-#: ../src/callbacks.c:120 ../src/callbacks.c:124
+#: src/callbacks.c:120 src/callbacks.c:124
 msgid "Save Digest File"
 msgstr ""
 
-#: ../src/callbacks.c:121 ../src/callbacks.c:127
+#: src/callbacks.c:121 src/callbacks.c:127
 msgid "_Save"
 msgstr ""
 
-#: ../src/callbacks.c:274
+#: src/callbacks.c:274
 msgid "A desktop utility for computing message digests or checksums"
 msgstr ""
 
-#: ../src/callbacks.c:279
+#: src/callbacks.c:279
 msgid "translator-credits"
 msgstr ""
 
-#: ../src/callbacks.c:307 ../src/callbacks.c:311
+#: src/callbacks.c:307 src/callbacks.c:311
 msgid "Select Files"
 msgstr ""
 
-#: ../src/callbacks.c:529 ../src/nautilus/properties.c:256
+#: src/callbacks.c:529 src/nautilus/properties.c:256
 msgid "_Show HMAC Key"
 msgstr ""
 
-#: ../src/check.c:202
+#: src/check.c:202
 #, c-format
 msgid "Failed to read check file \"%s\": %s"
 msgstr ""
 
-#: ../src/gui.c:308
+#: src/gui.c:308
 msgid "Not a regular file"
 msgstr ""
 
-#: ../src/gui.c:331
+#: src/gui.c:331
 #, c-format
 msgid "Failed to add file \"%s\": %s"
 msgstr ""
 
-#: ../src/hash.c:188 ../src/prefs.c:113
+#: src/hash.c:188 src/prefs.c:113
 #, c-format
 msgid "Unknown Hash Function name \"%s\""
 msgstr ""
 
-#: ../src/opts.c:97
+#: src/opts.c:97
 msgctxt " --help"
 msgid "Check against the specified digest or checksum"
 msgstr ""
 
-#: ../src/opts.c:98
+#: src/opts.c:98
 msgctxt " --help"
 msgid "DIGEST"
 msgstr ""
 
-#: ../src/opts.c:103
+#: src/opts.c:103
 msgctxt " --help"
 msgid "Check digests or checksums from the specified file"
 msgstr ""
 
-#: ../src/opts.c:104
+#: src/opts.c:104
 msgctxt " --help"
 msgid "FILE|URI"
 msgstr ""
 
-#: ../src/opts.c:109
+#: src/opts.c:109
 msgctxt " --help"
 msgid "Enable the specified Hash Function (e.g. MD5)"
 msgstr ""
 
-#: ../src/opts.c:110
+#: src/opts.c:110
 msgctxt " --help"
 msgid "FUNCTION"
 msgstr ""
 
-#: ../src/opts.c:114
+#: src/opts.c:114
 msgctxt " --help"
 msgid "Hash the specified text"
 msgstr ""
 
-#: ../src/opts.c:115
+#: src/opts.c:115
 msgctxt " --help"
 msgid "TEXT"
 msgstr ""
 
-#: ../src/opts.c:119
+#: src/opts.c:119
 msgctxt " --help"
 msgid "Show version information"
 msgstr ""
 
 #. Translators: Unicode ellipsis(…) can be used here
-#: ../src/opts.c:124
+#: src/opts.c:124
 msgctxt " --help"
 msgid "[FILE|URI...]"
 msgstr ""
 
-#: ../src/prefs.c:82
+#: src/prefs.c:82
 msgid "Failed to enable any supported hash functions."
 msgstr ""
 
-#: ../src/util/util.c:35
+#: src/util/util.c:35
 #, c-format
 msgid "%u minute left"
 msgid_plural "%u minutes left"
 msgstr[0] ""
 msgstr[1] ""
 
-#: ../src/util/util.c:39
+#: src/util/util.c:39
 #, c-format
 msgid "%u second left"
 msgid_plural "%u seconds left"
 msgstr[0] ""
 msgstr[1] ""
 
-#: ../src/util/util.c:58
+#: src/util/util.c:58
 #, c-format
 msgid "%s of %s - %s (%s/sec)"
 msgstr ""
 
-#: ../data/caja/libgtkhash-properties-caja.caja-extension.in.h:1
-#: ../data/peony/libgtkhash-properties-peony.peony-extension.in.h:1
-#: ../src/nautilus/properties.c:479 ../src/nautilus/properties.c:482
-#: ../src/nautilus/properties.c:485 ../src/nautilus/properties.c:488
-#: ../src/nautilus/properties.c:490
-#: ../data/appdata/org.gtkhash.caja.metainfo.xml.in.h:1
-#: ../data/appdata/org.gtkhash.nautilus.metainfo.xml.in.h:1
-#: ../data/appdata/org.gtkhash.nemo.metainfo.xml.in.h:1
-#: ../data/appdata/org.gtkhash.peony.metainfo.xml.in.h:1
-#: ../data/appdata/org.gtkhash.thunar.metainfo.xml.in.h:1
-msgid "Checksums"
-msgstr ""
-
-#: ../data/nautilus/gtkhash-properties.xml.h:1
+#: data/nautilus/gtkhash-properties.ui:16
 msgid "_Copy Digest"
 msgstr ""
 
-#: ../data/nautilus/gtkhash-properties.xml.h:2
+#: data/nautilus/gtkhash-properties.ui:35
 msgid "Show _Disabled Hash Functions"
 msgstr ""
 
-#: ../data/nautilus/gtkhash-properties.xml.h:3
+#: data/nautilus/gtkhash-properties.ui:95
 msgid "Hash Function"
 msgstr ""
 
-#: ../data/nautilus/gtkhash-properties.xml.h:4
+#: data/nautilus/gtkhash-properties.ui:106
 msgid "Digest"
 msgstr ""
 
-#: ../data/nautilus/gtkhash-properties.xml.h:8
+#: data/nautilus/gtkhash-properties.ui:271
 msgid "H_ash"
 msgstr ""
 
-#: ../data/appdata/org.gtkhash.gtkhash.appdata.xml.in.h:2
+#: src/nautilus/properties.c:479 src/nautilus/properties.c:482
+#: src/nautilus/properties.c:485 src/nautilus/properties.c:488
+#: src/nautilus/properties.c:490
+#: data/appdata/org.gtkhash.caja.metainfo.xml.in:7
+#: data/appdata/org.gtkhash.nautilus.metainfo.xml.in:7
+#: data/appdata/org.gtkhash.nemo.metainfo.xml.in:8
+#: data/appdata/org.gtkhash.peony.metainfo.xml.in:7
+#: data/appdata/org.gtkhash.thunar.metainfo.xml.in:7
+msgid "Checksums"
+msgstr ""
+
+#: data/appdata/org.gtkhash.gtkhash.appdata.xml.in:10
 msgid ""
 "GtkHash is an application for computing file checksums, or message digests. "
 "It's designed to be an easy to use, graphical alternative to command-line "
 "programs such as md5sum."
 msgstr ""
 
-#: ../data/appdata/org.gtkhash.gtkhash.appdata.xml.in.h:3
+#: data/appdata/org.gtkhash.gtkhash.appdata.xml.in:15
 msgid "Supported hash functions include MD5, SHA1, SHA256, SHA512 and CRC32."
 msgstr ""
 
-#: ../data/appdata/org.gtkhash.caja.metainfo.xml.in.h:2
-#: ../data/appdata/org.gtkhash.nautilus.metainfo.xml.in.h:2
-#: ../data/appdata/org.gtkhash.nemo.metainfo.xml.in.h:2
-#: ../data/appdata/org.gtkhash.peony.metainfo.xml.in.h:2
-#: ../data/appdata/org.gtkhash.thunar.metainfo.xml.in.h:2
+#: data/appdata/org.gtkhash.caja.metainfo.xml.in:8
+#: data/appdata/org.gtkhash.nautilus.metainfo.xml.in:8
+#: data/appdata/org.gtkhash.nemo.metainfo.xml.in:9
+#: data/appdata/org.gtkhash.peony.metainfo.xml.in:8
+#: data/appdata/org.gtkhash.thunar.metainfo.xml.in:8
 msgid "Adds message digests or checksums to file properties"
 msgstr ""
diff --git a/po/nb_NO.po b/po/nb_NO.po
index 11e5bea..793eca4 100644
--- a/po/nb_NO.po
+++ b/po/nb_NO.po
@@ -275,7 +275,7 @@ msgstr[1] "%u minutter igjen"
 #, c-format
 msgid "%u second left"
 msgid_plural "%u seconds left"
-msgstr[0] "%d sekund igjen"
+msgstr[0] "%u sekund igjen"
 msgstr[1] "%u sekunder igjen"
 
 #: ../src/util/util.c:58
diff --git a/po/zh_CN.po b/po/zh_CN.po
index 1a566ae..7bb10e4 100644
--- a/po/zh_CN.po
+++ b/po/zh_CN.po
@@ -274,14 +274,12 @@ msgstr "无法启用任何支持的哈希函数。"
 msgid "%u minute left"
 msgid_plural "%u minutes left"
 msgstr[0] "剩余%u分钟"
-msgstr[1] "剩余%u分钟"
 
 #: ../src/util/util.c:39
 #, c-format
 msgid "%u second left"
 msgid_plural "%u seconds left"
 msgstr[0] "剩余%u秒"
-msgstr[1] "剩余%u秒"
 
 #: ../src/util/util.c:58
 #, c-format
diff --git a/snap/snapcraft.yaml b/snap/snapcraft.yaml
index 890f498..1847eb8 100644
--- a/snap/snapcraft.yaml
+++ b/snap/snapcraft.yaml
@@ -24,7 +24,6 @@ parts:
       - pkg-config
       - libtool
       - gettext
-      - intltool
       - libglib2.0-dev
       - libgtk-3-dev
       - libgcrypt20-dev
diff --git a/src/Makefile.am b/src/Makefile.am
index ce01760..8684b45 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -65,7 +65,7 @@ EXTRA_DIST = gtkhash-test.sh test.md5sum.in
 
 resources.c resources.h: \
 	../data/gtkhash-gtk3.gresource.xml \
-	../data/gtkhash-gtk3.xml
+	../data/gtkhash-gtk3.ui
 	$(AM_V_GEN) $(GLIB_COMPILE_RESOURCES) \
 		--c-name resources \
 		--internal \
diff --git a/src/gui.c b/src/gui.c
index 6912e6d..752cc59 100644
--- a/src/gui.c
+++ b/src/gui.c
@@ -39,7 +39,7 @@
 #include "hash/digest-format.h"
 #include "hash/hash-func.h"
 
-#define GUI_XML_RESOURCE "/org/gtkhash/gtkhash-gtk3.xml"
+#define GUI_XML_RESOURCE "/org/gtkhash/gtkhash-gtk3.ui"
 
 struct gui_s gui = {
 	.view = GUI_VIEW_INVALID,
diff --git a/src/main.h b/src/main.h
index 2c55c61..2e24abe 100644
--- a/src/main.h
+++ b/src/main.h
@@ -1,5 +1,5 @@
 /*
- *   Copyright (C) 2007-2013 Tristan Heaven <tristan@tristanheaven.net>
+ *   Copyright (C) 2007-2020 Tristan Heaven <tristan@tristanheaven.net>
  *
  *   This file is part of GtkHash.
  *
@@ -23,7 +23,8 @@
 #if ENABLE_NLS
 	#include <glib/gi18n.h>
 #else
-	#define _(X) (X)
+	#define _(STR) (STR)
+	#define C_(CONTEXT, STR) (STR)
 #endif
 
 #endif
diff --git a/src/nautilus/Makefile.am b/src/nautilus/Makefile.am
index 673ca72..4a26e43 100644
--- a/src/nautilus/Makefile.am
+++ b/src/nautilus/Makefile.am
@@ -170,7 +170,7 @@ endif
 
 properties-resources.c: \
 	../../data/nautilus/gtkhash-properties.gresource.xml \
-	../../data/nautilus/gtkhash-properties.xml
+	../../data/nautilus/gtkhash-properties.ui
 	$(AM_V_GEN) $(GLIB_COMPILE_RESOURCES) \
 		--c-name gtkhash_properties_resources \
 		--internal \
diff --git a/src/nautilus/properties.c b/src/nautilus/properties.c
index bef8b89..ef77f8c 100644
--- a/src/nautilus/properties.c
+++ b/src/nautilus/properties.c
@@ -55,7 +55,7 @@
 #include "../hash/hash-func.h"
 #include "../hash/hash-file.h"
 
-#define PROPERTIES_XML_RESOURCE "/org/gtkhash/plugin/gtkhash-properties.xml"
+#define PROPERTIES_XML_RESOURCE "/org/gtkhash/plugin/gtkhash-properties.ui"
 
 static GType page_type;
 
diff --git a/src/nautilus/properties.h b/src/nautilus/properties.h
index 1d6edab..573ad19 100644
--- a/src/nautilus/properties.h
+++ b/src/nautilus/properties.h
@@ -1,5 +1,5 @@
 /*
- *   Copyright (C) 2007-2016 Tristan Heaven <tristan@tristanheaven.net>
+ *   Copyright (C) 2007-2020 Tristan Heaven <tristan@tristanheaven.net>
  *
  *   This file is part of GtkHash.
  *
@@ -27,7 +27,7 @@
 #if ENABLE_NLS
 	#include <glib/gi18n-lib.h>
 #else
-	#define _(X) (X)
+	#define _(STR) (STR)
 #endif
 
 struct page_s {
